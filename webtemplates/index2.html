
<!DOCTYPE html>
<html lang="en">
    <head>
        <link href="/css/tabulator_site.css" rel="stylesheet">
    </head>
    <body>       
        <div id="table1"></div>
            <script type="text/javascript" src="/js/tabulator.min.js"></script>
        <script type="text/javascript">
    //table data
    var tabledata = [
    {% for job in jsongeneraldict %}    
        {
            id:{{ loop.index }}, 
            jobname:"{{ job.jobname }}", 
            src:"{{ job.src }}", 
            dst:"{{ job.dst }}", 
            baselinestatus:"{{ job.baselinestatus }}", 
            baselinetime:"{{ job.baselinetime }}", 
            baselinesentshort:"{{ job.baselinesentshort }}", 
            syncstatus:"{{ job.syncstatus }}", 
            syncsched:"{{ job.syncsched }}", 
            synctime:"{{ job.synctime }}", 
            syncsentshort:"{{ job.syncsentshort }}", 
            synccounter:"{{ job.synccounter }}", 
            verifystatus:"{{ job.verifystatus }}", 
            verifystarttime:"{{ job.verifystarttime }}", 
            verifyratio:"{{ job.verifyratio }}", 
            verifycounter:"{{ job.verifycounter }}",
            serviceHistory:[
                {date:"01/02/2016", engineer:"Steve Boberson", actions:"Changed oli filter"},
                {date:"07/02/2017", engineer:"Martin Stevenson", actions:"Break light broken"},
            ],
        },
    {% endfor %}        
    ];

    var hideIcon = function(cell, formatterParams, onRendered){ //plain text value
        return "<i class='fa fa-eye-slash'></i>";
    };

    var table1 = new Tabulator("#table1", {
        //height:"311px",
        columnHeaderVertAlign:"bottom", //align header contents to bottom of cell
        layout:"fitdataStreach",        
        selectable: true,
        data:tabledata,
        columns:[
            {title:"", formatter:hideIcon, align:"center", headerSort:false, cellClick:function(e, row, formatterParams){
                const id = row.getData().id;
                $(".subTable" + id + "").toggle();}
            },
            {title:"Job Name", field:"jobname"},
            {title:"Source", field:"src"},
            {title:"Destination", field:"dst"},
            {title:"Status", field:"baselinestatus",},
            {title:"Duration", field:"baselinetime"},
            {title:"Sent", field:"baselinesentshort"},
            {title:"Status", field:"syncstatus"},
            {title:"Next Schedule", field:"syncsched"},
            {title:"Duration", field:"synctime"},
            {title:"Sent", field:"syncsentshort"},
            {title:"Count", field:"synccounter"},
            {title:"Status", field:"verifystatus"},
            {title:"Start Time", field:"verifystarttime"}, 
            {title:"Ratio", field:"verifyratio"},
            {title:"Count", field:"verifycounter"},

        ],
        rowFormatter:function(row){
            //create and style holder elements
            var holderEl = document.createElement("div");
            var tableEl = document.createElement("div");

            const id = row.getData().id;

            holderEl.style.boxSizing = "border-box";
            holderEl.style.padding = "10px 10px 10px 10px";
            holderEl.style.borderTop = "1px solid #333";
            holderEl.style.borderBotom = "1px solid #333";
            holderEl.style.background = "#ddd";
            holderEl.setAttribute('class', "subTable" + id + "");


            tableEl.style.border = "1px solid #333";
            tableEl.setAttribute('class', "subTable" + id + "");

            holderEl.appendChild(tableEl);

            row.getElement().appendChild(holderEl);

            var subTable = new Tabulator(tableEl, {
                layout:"fitColumns",
                data:row.getData().serviceHistory,
                columns:[
                    {title:"Date", field:"date", sorter:"date"},
                    {title:"Engineer", field:"engineer"},
                    {title:"Action", field:"actions"},
                ]
           })        
        },
    });
        </script>
    </body>
</html>
